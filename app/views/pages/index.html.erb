<ul></ul>

<%= javascript_include_tag "pusher-1.12.5" %>
<script>
  window.addEventListener("DOMContentLoaded", function() {
    <% if defined?(PusherFake) %>
      Pusher.host    = <%== PusherFake.configuration.socket_host.to_json %>;
      Pusher.ws_port = <%== PusherFake.configuration.socket_port.to_json %>;
    <% end %>

    Pusher.instance = new Pusher(<%== Pusher.key.to_json %>);

    var
    Chat = Pusher.instance.subscribe("chat");
    Chat.bind("message", function(message) {
      var list    = document.getElementsByTagName("ul")[0],
          item    = document.createElement("li"),
          message = document.createTextNode(message.body);

      item.appendChild(message);
      list.appendChild(item);
    });
  }, false);
</script>
